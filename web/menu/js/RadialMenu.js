"use strict";var DEFAULT_SIZE=100,MIN_SECTORS=4;function RadialMenu(e){var t=this;t.parent=e.parent||[],t.size=e.size||DEFAULT_SIZE,t.onClick=e.onClick||null,t.menuItems=e.menuItems?e.menuItems:[{id:"one",title:"One"},{id:"two",title:"Two"}],t.radius=70,t.innerRadius=.4*t.radius,t.sectorSpace=.01*t.radius,t.sectorCount=Math.max(t.menuItems.length,MIN_SECTORS),t.closeOnClick=void 0!==e.closeOnClick&&!!e.closeOnClick,t.scale=1,t.holder=null,t.parentMenu=[],t.parentItems=[],t.levelItems=null,t.menuName=e.menuName,t.createHolder(),t.addIconSymbols(),t.currentMenu=null,document.addEventListener("wheel",t.onMouseWheel.bind(t)),document.addEventListener("keydown",t.onKeyDown.bind(t))}RadialMenu.prototype.open=function(){var e=this;e.currentMenu||(e.currentMenu=e.createMenu("menu inner",e.menuItems),e.holder.appendChild(e.currentMenu),RadialMenu.nextTick(function(){e.currentMenu.setAttribute("class","menu")}))},RadialMenu.prototype.close=function(){var e=this;if(e.currentMenu){for(var t;t=e.parentMenu.pop();)t.remove();e.parentItems=[],RadialMenu.setClassAndWaitForTransition(e.currentMenu,"menu inner").then(function(){document.dispatchEvent(new CustomEvent("onClose",{detail:e.currentMenu,menuName:e.menuName})),e.currentMenu.remove(),e.currentMenu=null})}},RadialMenu.prototype.getParentMenu=function(){var e=this;return 0<e.parentMenu.length?e.parentMenu[e.parentMenu.length-1]:null},RadialMenu.prototype.createHolder=function(){var e=this;e.holder=document.createElement("div"),e.holder.className="menuHolder",e.holder.style.width=e.size+"px",e.holder.style.height=e.size+"px",e.parent.appendChild(e.holder)},RadialMenu.prototype.showNestedMenu=function(e){var t=this;t.parentMenu.push(t.currentMenu),t.parentItems.push(t.levelItems),t.currentMenu=t.createMenu("menu inner",e.items,!0),t.holder.appendChild(t.currentMenu),RadialMenu.nextTick(function(){t.getParentMenu().setAttribute("class","menu outer"),t.currentMenu.setAttribute("class","menu")})},RadialMenu.prototype.returnToParentMenu=function(){var e=this;e.getParentMenu().setAttribute("class","menu"),RadialMenu.setClassAndWaitForTransition(e.currentMenu,"menu inner").then(function(){e.currentMenu.remove(),e.currentMenu=e.parentMenu.pop(),e.levelItems=e.parentItems.pop()})},RadialMenu.prototype.handleClick=function(){var e=this,t=e.getSelectedIndex();if(0<=t){var n=e.levelItems[t];n.items?e.showNestedMenu(n):e.onClick&&(e.onClick(n),e.closeOnClick&&e.close())}},RadialMenu.prototype.handleCenterClick=function(){var e=this;0<e.parentItems.length?e.returnToParentMenu():e.close()},RadialMenu.prototype.createCenter=function(e,t,n,r){var a=this;r=r||8;var i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("class","center");var u=a.createCircle(0,0,a.innerRadius-a.sectorSpace/3);if(i.appendChild(u),s){var s=a.createText(0,0,t);i.appendChild(s)}if(n){var l=a.createUseTag(0,0,n);l.setAttribute("width",r),l.setAttribute("height",r),l.setAttribute("transform","translate(-"+RadialMenu.numberToString(r/2)+",-"+RadialMenu.numberToString(r/2)+")"),i.appendChild(l)}e.appendChild(i)},RadialMenu.prototype.getIndexOffset=function(){var e=this;if(!(e.levelItems.length<e.sectorCount))return-1;switch(e.levelItems.length){case 1:case 2:case 3:return-2;default:return-1}},RadialMenu.prototype.createMenu=function(e,t,n){var r=this;r.levelItems=t,r.sectorCount=Math.max(r.levelItems.length,MIN_SECTORS),r.scale=r.calcScale();var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class",e),a.setAttribute("viewBox","-50 -50 100 100"),a.setAttribute("width",r.size),a.setAttribute("height",r.size);for(var i=360/r.sectorCount,u=i/2+270,s=r.getIndexOffset(),l=0;l<r.sectorCount;++l){var o,c=u+i*l,d=u+i*(l+1),p=RadialMenu.resolveLoopIndex(r.sectorCount-l+s,r.sectorCount);o=0<=p&&p<r.levelItems.length?r.levelItems[p]:null,r.appendSectorPath(c,d,a,o,p)}return n?r.createCenter(a,"Close","#return",8):r.createCenter(a,"Close","#close",7),a.addEventListener("mousedown",function(e){switch(e.target.parentNode.getAttribute("class").split(" ")[0]){case"sector":var t=parseInt(e.target.parentNode.getAttribute("data-index"));isNaN(t)||r.setSelectedIndex(t)}}),a.addEventListener("click",function(e){switch(e.target.parentNode.getAttribute("class").split(" ")[0]){case"sector":r.handleClick();break;case"center":r.handleCenterClick()}}),a},RadialMenu.prototype.selectDelta=function(e){var t=this,n=t.getSelectedIndex();n<0&&(n=0),(n+=e)<0?n=t.levelItems.length+n:n>=t.levelItems.length&&(n-=t.levelItems.length),t.setSelectedIndex(n)},RadialMenu.prototype.onKeyDown=function(e){var t=this;if(t.currentMenu)switch(e.key){case"Escape":case"Backspace":t.handleCenterClick(),e.preventDefault();break;case"Enter":t.handleClick(),e.preventDefault();break;case"ArrowRight":case"ArrowUp":t.selectDelta(1),e.preventDefault();break;case"ArrowLeft":case"ArrowDown":t.selectDelta(-1),e.preventDefault()}},RadialMenu.prototype.onMouseWheel=function(e){var t=this;t.currentMenu&&(0<-e.deltaY?t.selectDelta(1):t.selectDelta(-1))},RadialMenu.prototype.getSelectedNode=function(){var e=this.currentMenu.getElementsByClassName("selected");return 0<e.length?e[0]:null},RadialMenu.prototype.getSelectedIndex=function(){var e=this.getSelectedNode();return e?parseInt(e.getAttribute("data-index")):-1},RadialMenu.prototype.setSelectedIndex=function(e){if(0<=e&&e<this.levelItems.length){var t=this.currentMenu.querySelectorAll('g[data-index="'+e+'"]');if(0<t.length){var n=t[0],r=this.getSelectedNode();r&&r.setAttribute("class","sector"),n.setAttribute("class","sector selected")}}},RadialMenu.prototype.createUseTag=function(e,t,n){var r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttribute("x",RadialMenu.numberToString(e)),r.setAttribute("y",RadialMenu.numberToString(t)),r.setAttribute("width","10"),r.setAttribute("height","10"),r.setAttribute("fill","white"),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r},RadialMenu.prototype.appendSectorPath=function(e,t,n,r,a){var i=this,u=i.getSectorCenter(e,t),s=RadialMenu.numberToString((1-i.scale)*u.x),l=RadialMenu.numberToString((1-i.scale)*u.y),o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("transform","translate("+s+" ,"+l+") scale("+i.scale+")");var c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",i.createSectorCmds(e,t)),o.appendChild(c),r){if(o.setAttribute("class","sector"),0==a&&o.setAttribute("class","sector"),o.setAttribute("data-id",r.id),o.setAttribute("data-index",a),r.title){var d=i.createText(u.x,u.y,r.title);r.icon?d.setAttribute("transform","translate(0,8)"):d.setAttribute("transform","translate(0,2)"),o.appendChild(d)}if(r.icon){var p=i.createUseTag(u.x,u.y,r.icon);r.title?p.setAttribute("transform","translate(-5,-8)"):p.setAttribute("transform","translate(-5,-5)"),o.appendChild(p)}}else o.setAttribute("class","dummy");n.appendChild(o)},RadialMenu.prototype.createSectorCmds=function(e,t){var n=this,r=RadialMenu.getDegreePos(e,n.radius),a="M"+RadialMenu.pointToString(r),i=n.radius*(1/n.scale);a+="A"+i+" "+i+" 0 0 0"+RadialMenu.pointToString(RadialMenu.getDegreePos(t,n.radius)),a+="L"+RadialMenu.pointToString(RadialMenu.getDegreePos(t,n.innerRadius));var u=n.radius-n.innerRadius,s=(u-u*n.scale)/2,l=(n.innerRadius+s)*(1/n.scale);return a+="A"+l+" "+l+" 0 0 1 "+RadialMenu.pointToString(RadialMenu.getDegreePos(e,n.innerRadius)),a+="Z"},RadialMenu.prototype.createText=function(e,t,n){var r=document.createElementNS("http://www.w3.org/2000/svg","text");return r.setAttribute("text-anchor","middle"),r.setAttribute("x",RadialMenu.numberToString(e)),r.setAttribute("y",RadialMenu.numberToString(t)),r.setAttribute("font-size","38%"),r.innerHTML=n,r},RadialMenu.prototype.createCircle=function(e,t,n){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");return r.setAttribute("cx",RadialMenu.numberToString(e)),r.setAttribute("cy",RadialMenu.numberToString(t)),r.setAttribute("r",n),r},RadialMenu.prototype.calcScale=function(){var e=this,t=e.sectorSpace*e.sectorCount,n=2*Math.PI*e.radius,r=e.radius-(n-t)/(2*Math.PI);return(e.radius-r)/e.radius},RadialMenu.prototype.getSectorCenter=function(e,t){return RadialMenu.getDegreePos((e+t)/2,this.innerRadius+(this.radius-this.innerRadius)/2)},RadialMenu.prototype.addIconSymbols=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","icons");var t=document.createElementNS("http://www.w3.org/2000/svg","symbol");t.setAttribute("id","return"),t.setAttribute("viewBox","0 0 489.394 489.394");var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M375.789,92.867H166.864l17.507-42.795c3.724-9.132,1-19.574-6.691-25.744c-7.701-6.166-18.538-6.508-26.639-0.879L9.574,121.71c-6.197,4.304-9.795,11.457-9.563,18.995c0.231,7.533,4.261,14.446,10.71,18.359l147.925,89.823c8.417,5.108,19.18,4.093,26.481-2.499c7.312-6.591,9.427-17.312,5.219-26.202l-19.443-41.132h204.886c15.119,0,27.418,12.536,27.418,27.654v149.852c0,15.118-12.299,27.19-27.418,27.19h-226.74c-20.226,0-36.623,16.396-36.623,36.622v12.942c0,20.228,16.397,36.624,36.623,36.624h226.74c62.642,0,113.604-50.732,113.604-113.379V206.709C489.395,144.062,438.431,92.867,375.789,92.867z"),t.appendChild(n),e.appendChild(t);var r=document.createElementNS("http://www.w3.org/2000/svg","symbol");r.setAttribute("id","close"),r.setAttribute("viewBox","0 0 41.756 41.756");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M27.948,20.878L40.291,8.536c1.953-1.953,1.953-5.119,0-7.071c-1.951-1.952-5.119-1.952-7.07,0L20.878,13.809L8.535,1.465c-1.951-1.952-5.119-1.952-7.07,0c-1.953,1.953-1.953,5.119,0,7.071l12.342,12.342L1.465,33.22c-1.953,1.953-1.953,5.119,0,7.071C2.44,41.268,3.721,41.755,5,41.755c1.278,0,2.56-0.487,3.535-1.464l12.343-12.342l12.343,12.343c0.976,0.977,2.256,1.464,3.535,1.464s2.56-0.487,3.535-1.464c1.953-1.953,1.953-5.119,0-7.071L27.948,20.878z"),r.appendChild(a),e.appendChild(r),this.holder.appendChild(e)},RadialMenu.getDegreePos=function(e,t){return{x:Math.sin(RadialMenu.degToRad(e))*t,y:Math.cos(RadialMenu.degToRad(e))*t}},RadialMenu.pointToString=function(e){return RadialMenu.numberToString(e.x)+" "+RadialMenu.numberToString(e.y)},RadialMenu.numberToString=function(e){if(Number.isInteger(e))return e.toString();if(e){var t=(+e).toFixed(5);return t.match(/\./)&&(t=t.replace(/\.?0+$/,"")),t}},RadialMenu.resolveLoopIndex=function(e,t){return e<0&&(e=t+e),t<=e&&(e-=t),e<t?e:null},RadialMenu.degToRad=function(e){return e*(Math.PI/180)},RadialMenu.setClassAndWaitForTransition=function(r,e){return new Promise(function(n){r.addEventListener("transitionend",function e(t){t.target==r&&"visibility"==t.propertyName&&(r.removeEventListener("transitionend",e),n())}),r.setAttribute("class",e)})},RadialMenu.nextTick=function(e){setTimeout(e,10)};